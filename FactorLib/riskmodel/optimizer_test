"""
优化器测试文件
使用兴业风格VG因子作为选股信号
"""
from datetime import datetime
from FactorLib.riskmodel.optimizer import Optimizer
from FactorLib.data_source.base_data_source_h5 import data_source

date = datetime(2014, 9, 30)
secID = '000905'
signal_name = 'StyleFactor_VG'
stockIDs = data_source.sector.get_index_members(ids=secID, dates=[date])
stockIDs = stockIDs[stockIDs.iloc[:, 0] == 1.0].index.get_level_values(1).tolist()
signal = data_source.load_factor(signal_name, '/XYData/StyleFactor/',
                                 ids=stockIDs, dates=[date])[signal_name].reset_index(level=0, drop=True)

opt = Optimizer(signal, date, ds_name='uqer', benchmark=secID)
opt.add_constraint('StockLimit', default_max=0.08)
opt.add_constraint('TrackingError', 0.0025)
opt.solve()
